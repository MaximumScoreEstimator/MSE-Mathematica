(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     35908,        858]
NotebookOptionsPosition[     34350,        799]
NotebookOutlinePosition[     34912,        823]
CellTagsIndexPosition[     34827,        818]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["confidence.nb", "Section",
 CellChangeTimes->{{3.62600628385137*^9, 3.626006284835745*^9}, {
  3.6260709487170696`*^9, 3.6260709533480415`*^9}, {3.626096953477417*^9, 
  3.6260969551364455`*^9}, {3.6261707215015993`*^9, 3.6261707234205446`*^9}, {
  3.6261736078812375`*^9, 3.6261736107103395`*^9}, {3.6263372687397165`*^9, 
  3.6263372730053415`*^9}, {3.6263379196147165`*^9, 3.6263379214897165`*^9}, {
  3.6263385349740915`*^9, 3.6263385373022165`*^9}, {3.6263390808490915`*^9, 
  3.6263390821459665`*^9}, {3.6303029709067054`*^9, 3.6303029750165725`*^9}, {
  3.68546745525683*^9, 3.685467455411772*^9}, {3.6854675586727667`*^9, 
  3.685467560186207*^9}}],

Cell[CellGroupData[{

Cell["For the Developer", "Subsubsection",
 CellChangeTimes->{{3.5819225877880845`*^9, 3.581922592443351*^9}}],

Cell["\<\
AutoGeneratedPackage is an option for notebooks that specifies whether a \
package is automatically created when a notebook that contains initialization \
cells or groups is saved.\
\>", "Text",
 CellChangeTimes->{{3.5808982533077106`*^9, 3.580898259632072*^9}}],

Cell[BoxData[
 RowBox[{"SetOptions", "[", 
  RowBox[{
   RowBox[{"InputNotebook", "[", "]"}], ",", 
   RowBox[{"AutoGeneratedPackage", "\[Rule]", "Automatic"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"$HistoryLength", "=", "0"}], ";"}]], "Input",
 CellChangeTimes->{{3.5816697178146343`*^9, 3.581669717815634*^9}}],

Cell[BoxData[
 RowBox[{"ClearSystemCache", "[", "]"}]], "Input",
 CellChangeTimes->{{3.581669726757145*^9, 3.5816697379287844`*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Confidence Intervals", "Section",
 CellChangeTimes->{{3.6216659659272532`*^9, 3.6216659761698494`*^9}, {
  3.6217614343934107`*^9, 3.6217614422059107`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"RandomSample", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6", ",", "7", ",", 
     "8"}], "}"}], ",", "4"}], "]"}]], "Input",
 CellChangeTimes->{{3.6327437593201857`*^9, 3.632743772456905*^9}},
 Background->RGBColor[1, 0.85, 0.85]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"4", ",", "5", ",", "3", ",", "6"}], "}"}]], "Output",
 CellChangeTimes->{{3.6327437728416705`*^9, 3.6327437838992877`*^9}}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Off", "[", 
   RowBox[{"General", "::", "compat"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Combinatorica`\>\"", "]"}], 
  RowBox[{"(*", 
   RowBox[{"For", " ", "RandomKSubset"}], "*)"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6217635233846216`*^9, 3.6217635308377466`*^9}, {
  3.6217635920252466`*^9, 3.6217636063221216`*^9}, {3.621764203171731*^9, 
  3.621764226343606*^9}, {3.6303052201701193`*^9, 3.6303052402326193`*^9}},
 Background->RGBColor[0.88, 1, 0.88]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"RandomKSubset", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6", ",", "7", ",", 
     "8"}], "}"}], ",", "4"}], "]"}]], "Input",
 CellChangeTimes->{{3.6217636410252466`*^9, 3.6217636458533716`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"2", ",", "5", ",", "6", ",", "7"}], "}"}]], "Output",
 CellChangeTimes->{
  3.6217636463846216`*^9, {3.632743776016475*^9, 3.632743777893428*^9}}]
}, Open  ]],

Cell[BoxData[Cell[TextData[{
  Cell[BoxData[
   RowBox[{"RandomKSubset", "[", 
    RowBox[{
     StyleBox["l", "TI"], ",", 
     StyleBox["k", "TI"]}], "]"}]], "InlineFormula"],
  "\[LineSeparator]gives a random subset of set ",
  Cell[BoxData[
   FormBox[
    StyleBox["l", "TI"], TraditionalForm]], "InlineFormula"],
  " with exactly ",
  Cell[BoxData[
   FormBox[
    StyleBox["k", "TI"], TraditionalForm]], "InlineFormula"],
  " elements."
 }]]], "Usage",
 GridBoxOptions->{
 GridBoxBackground->{
  "Columns" -> {{None}}, "ColumnsIndexed" -> {}, "Rows" -> {{None}}, 
   "RowsIndexed" -> {}}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"?", "RandomChoice"}]], "Input",
 CellChangeTimes->{{3.6217636534471216`*^9, 3.6217636576346216`*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox["\<\"\\!\\(\\*RowBox[{\\\"RandomChoice\\\", \\\"[\\\", \
RowBox[{\\\"{\\\", RowBox[{SubscriptBox[StyleBox[\\\"e\\\", \\\"TI\\\"], \
StyleBox[\\\"1\\\", \\\"TR\\\"]], \\\",\\\", SubscriptBox[StyleBox[\\\"e\\\", \
\\\"TI\\\"], StyleBox[\\\"2\\\", \\\"TR\\\"]], \\\",\\\", StyleBox[\\\"\
\[Ellipsis]\\\", \\\"TR\\\"]}], \\\"}\\\"}], \\\"]\\\"}]\\) gives a \
pseudorandom choice of one of the \\!\\(\\*SubscriptBox[StyleBox[\\\"e\\\", \
\\\"TI\\\"], StyleBox[\\\"i\\\", \\\"TI\\\"]]\\). \
\\n\\!\\(\\*RowBox[{\\\"RandomChoice\\\", \\\"[\\\", \
RowBox[{StyleBox[\\\"list\\\", \\\"TI\\\"], \\\",\\\", StyleBox[\\\"n\\\", \\\
\"TI\\\"]}], \\\"]\\\"}]\\) gives a list of \\!\\(\\*StyleBox[\\\"n\\\", \
\\\"TI\\\"]\\) pseudorandom choices. \
\\n\\!\\(\\*RowBox[{\\\"RandomChoice\\\", \\\"[\\\", \
RowBox[{StyleBox[\\\"list\\\", \\\"TI\\\"], \\\",\\\", RowBox[{\\\"{\\\", \
RowBox[{SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], StyleBox[\\\"1\\\", \
\\\"TR\\\"]], \\\",\\\", SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], \
StyleBox[\\\"2\\\", \\\"TR\\\"]], \\\",\\\", StyleBox[\\\"\[Ellipsis]\\\", \\\
\"TR\\\"]}], \\\"}\\\"}]}], \\\"]\\\"}]\\) gives an \
\\!\\(\\*SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], StyleBox[\\\"1\\\", \\\
\"TR\\\"]]\\)\[Times]\\!\\(\\*SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], \
StyleBox[\\\"2\\\", \\\"TR\\\"]]\\)\[Times]\[Ellipsis] array of pseudorandom \
choices. \\n\\!\\(\\*RowBox[{\\\"RandomChoice\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"{\\\", RowBox[{SubscriptBox[StyleBox[\\\"w\\\", \
\\\"TI\\\"], StyleBox[\\\"1\\\", \\\"TR\\\"]], \\\",\\\", \
SubscriptBox[StyleBox[\\\"w\\\", \\\"TI\\\"], StyleBox[\\\"2\\\", \
\\\"TR\\\"]], \\\",\\\", StyleBox[\\\"\[Ellipsis]\\\", \\\"TR\\\"]}], \\\"}\\\
\"}], \\\"\[Rule]\\\", RowBox[{\\\"{\\\", RowBox[{SubscriptBox[StyleBox[\\\"e\
\\\", \\\"TI\\\"], StyleBox[\\\"1\\\", \\\"TR\\\"]], \\\",\\\", \
SubscriptBox[StyleBox[\\\"e\\\", \\\"TI\\\"], StyleBox[\\\"2\\\", \
\\\"TR\\\"]], \\\",\\\", StyleBox[\\\"\[Ellipsis]\\\", \\\"TR\\\"]}], \\\"}\\\
\"}]}], \\\"]\\\"}]\\) gives a pseudorandom choice weighted by the \
\\!\\(\\*SubscriptBox[StyleBox[\\\"w\\\", \\\"TI\\\"], StyleBox[\\\"i\\\", \\\
\"TI\\\"]]\\). \\n\\!\\(\\*RowBox[{\\\"RandomChoice\\\", \\\"[\\\", \
RowBox[{RowBox[{StyleBox[\\\"wlist\\\", \\\"TI\\\"], \\\"\[Rule]\\\", \
StyleBox[\\\"elist\\\", \\\"TI\\\"]}], \\\",\\\", StyleBox[\\\"n\\\", \
\\\"TI\\\"]}], \\\"]\\\"}]\\) gives a list of \\!\\(\\*StyleBox[\\\"n\\\", \\\
\"TI\\\"]\\) weighted choices.\\n\\!\\(\\*RowBox[{\\\"RandomChoice\\\", \\\"[\
\\\", RowBox[{RowBox[{StyleBox[\\\"wlist\\\", \\\"TI\\\"], \\\"\[Rule]\\\", \
StyleBox[\\\"elist\\\", \\\"TI\\\"]}], \\\",\\\", RowBox[{\\\"{\\\", \
RowBox[{SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], StyleBox[\\\"1\\\", \
\\\"TR\\\"]], \\\",\\\", SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], \
StyleBox[\\\"2\\\", \\\"TR\\\"]], \\\",\\\", StyleBox[\\\"\[Ellipsis]\\\", \\\
\"TR\\\"]}], \\\"}\\\"}]}], \\\"]\\\"}]\\) gives an \
\\!\\(\\*SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], StyleBox[\\\"1\\\", \\\
\"TR\\\"]]\\)\[Times]\\!\\(\\*SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], \
StyleBox[\\\"2\\\", \\\"TR\\\"]]\\)\[Times]\[Ellipsis] array of weighted \
choices.\"\>", "MSG"], "\[NonBreakingSpace]", 
  ButtonBox[
   StyleBox["\[RightSkeleton]", "SR"],
   Active->True,
   BaseStyle->"Link",
   ButtonData->"paclet:ref/RandomChoice"]}]], "Print", "PrintUsage",
 CellChangeTimes->{3.6217636581658716`*^9},
 CellTags->"Info3621774458-2672526"]
}, Open  ]],

Cell["\<\
generateRandomSubsample - Generates a subsample of a given size from a data \
array.

Parameters:
ssSize - Size of the subsample generated,in terms of number of distinct \
entities that will be represented in the subsample (ie,nests or coalitions).
groupIDs - A data map that the routine will use to examine the rows of the \
data array for possible inclusion into the subsample.
dataArray - A data array structure suitable for passing into the objective \
function.\
\>", "Text",
 CellChangeTimes->{{3.62176264355552*^9, 3.62176268077427*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "generateRandomSubsample", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"generateRandomSubsample", "::", "usage"}], "=", 
   "\"\<generateRandomSubsample[ssSize,groupIDs,dataArray] generates a \
subsample of a given size from a data array.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"generateRandomSubsample", "[", 
    RowBox[{"ssSize_", ",", "groupIDs_", ",", "dataArray_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"totalGroups", ",", "groups", ",", "qualifiedIndexes"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"totalGroups", "=", 
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"groupIDs", ",", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"groups", "=", 
       RowBox[{"RandomKSubset", "[", 
        RowBox[{"totalGroups", ",", "ssSize"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"\"\<stdout\>\"", ",", "\"\< \>\"", ",", "groups"}], "]"}], 
      ";", 
      RowBox[{"(*", 
       RowBox[{"TCHRONIS", " ", "for", " ", "verbose", " ", "results"}], 
       "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Get", " ", "the", " ", "indexes", " ", "of", " ", "the", " ", 
        "dataArray", " ", "rows", " ", "that", " ", "correspond", " ", "to", 
        " ", "selected", " ", 
        RowBox[{"groups", "."}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"qualifiedIndexes", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"groupIDs", ",", 
         RowBox[{"_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Intersection", "[", 
              RowBox[{"groups", ",", "#"}], "]"}], "\[NotEqual]", 
             RowBox[{"{", "}"}]}], "&"}], ")"}]}], ",", 
         RowBox[{"{", "1", "}"}], ",", 
         RowBox[{"Heads", "\[Rule]", "False"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "We", " ", "want", " ", "to", " ", "extract", " ", "certain", " ", 
         "rows"}], ",", 
        RowBox[{
        "so", " ", "we", " ", "need", " ", "to", " ", "transpose", " ", 
         "before", " ", "and", " ", "after", " ", "extracting", " ", "the", 
         " ", "rows", " ", "we", " ", "want"}], ",", 
        RowBox[{"due", " ", "to", " ", "the", " ", "matrix", " ", 
         RowBox[{"layout", "."}]}]}], "*)"}], 
      RowBox[{"Transpose", "[", 
       RowBox[{"Extract", "[", 
        RowBox[{"(*", 
         RowBox[{"Transpose", "["}], "*)"}], 
        RowBox[{"dataArray", 
         RowBox[{"(*", "]", "*)"}], ",", "qualifiedIndexes"}], "]"}], 
       "]"}]}]}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"TCHRONIS", " ", "for", " ", "precomputed"}], "*)"}], "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621762624383645*^9, 3.62176263843052*^9}, {
  3.6217637177596216`*^9, 3.6217637417752466`*^9}, {3.6218520478289895`*^9, 
  3.621852052501769*^9}, {3.6327448994778166`*^9, 3.6327449463949757`*^9}},
 Background->RGBColor[0.88, 1, 0.88]],

Cell[CellGroupData[{

Cell["pontIdentifiedCR", "Subsubsection",
 CellChangeTimes->{{3.622095879428526*^9, 3.6220958913816504`*^9}}],

Cell["CHECK OUT THE GLOBAL VARIABLES", "Text",
 CellChangeTimes->{{3.6217637832752466`*^9, 3.6217637910096216`*^9}},
 Background->RGBColor[1, 0.85, 0.85]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "pointIdentifiedCR", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "pointIdentifiedCR", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"progressUpdate", "\[Rule]", "0"}], ",", 
     RowBox[{"confidenceLevel", "\[Rule]", ".95"}], ",", 
     RowBox[{"asymptotics", "\[Rule]", "nests"}], ",", 
     RowBox[{"subsampleMonitor", "\[Rule]", "Null"}], ",", 
     RowBox[{"symmetric", "\[Rule]", "False"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"pointIdentifiedCR", "::", "usage"}], "=", 
    "\"\<pointIdentifiedCR[ssSize,numSubsamples,pointEstimate,args,groupIDs,\
dataArray,method,permuteinvariant,options] generates a confidence region \
estimate using subsampling.\\r\nParameters:\nssSize - The size of each \
subsample to be estimated.\nnumSubsamples -The number of subsamples to use in \
estimating the confidence region.\npointEstimate - The point estimate to \
build the confidence region around (typically the output of pairwiseMSE).\n\
objFunc - The objective function used in pairwiseMSE.\nargs - A list of \
unique symbols used in pairwiseMSE.\ngroupIDs - A data map used to generate \
the subsamples.\ndataArray - The dataArray parameter used in pairwiseMSE.\n\
options - An optional parameter specifying options. Available options are:\n\t\
progressUpdate - How often to print progress (0 to disable).Default=0. \n\t\
confidenceLevel - The confidence level of the region.Default=.95.\n\t\
asymptotics - Type of asymptotics to use (nests or coalitions).Default=nests.\
\n\tsubsampleMonitor - An expression to evaluate for each \
subsample.Default=Null.\n\tsymmetric - True or False.If True,the confidence \
region will be symmetric.Default=False.\>\""}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pointIdentifiedCR", "[", 
   RowBox[{
   "ssSize_", ",", "numSubsamples_", ",", "pointEstimate_", ",", "args_", ",",
     "groupIDs_", ",", "dataArray_", ",", "method_", ",", "permuteinvariant_",
     ",", 
    RowBox[{"options___", "?", "OptionQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "progress", ",", "confLevel", ",", "asymp", ",", "ssDataArray", ",", 
      "estimates", ",", "estimate", ",", "alpha", ",", "cr", ",", "sym"}], 
     "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"progress", ",", "confLevel", ",", "asymp", ",", "sym"}], 
       "}"}], "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "progressUpdate", ",", "confidenceLevel", ",", "asymptotics", ",", 
         "symmetric"}], "}"}], "/.", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{"options", ",", 
          RowBox[{"Options", "[", "pointIdentifiedCR", "]"}]}], "}"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "This", " ", "block", " ", "sets", " ", "variables", " ", "that", " ", 
        "are", " ", "slightly", " ", "different", " ", "for", " ", "each", 
        " ", "of", " ", "the", " ", "two", " ", 
        RowBox[{"asymptotics", ".", "subNormalization"}], " ", "is", " ", 
        "the", " ", "standardization", " ", "multiplier", " ", "for", " ", 
        "the", " ", "subsamples"}], ",", 
       RowBox[{
       "fullNormalization", " ", "is", " ", "the", " ", "multiplier", " ", 
        "for", " ", "the", " ", "construction", " ", "of", " ", "the", " ", 
        "final", " ", "confidence", " ", "interval", " ", "from", " ", "all", 
        " ", "of", " ", "the", " ", 
        RowBox[{"subsamples", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{
      "asymp", ",", "\[IndentingNewLine]", "nests", ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"subNormalization", "=", 
         RowBox[{
          RowBox[{"(", "ssSize", ")"}], "^", 
          RowBox[{"(", 
           RowBox[{"1", "/", "3"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        "\t", 
        RowBox[{"fullNormalization", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Length", "[", 
            RowBox[{"Union", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"groupIDs", ",", "1"}], "]"}], "]"}], "]"}], ")"}], "^", 
          RowBox[{"(", 
           RowBox[{"1", "/", "3"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        "\t", 
        RowBox[{"nextRandomSubsample", ":=", 
         RowBox[{"generateRandomSubsample", "[", 
          RowBox[{"ssSize", ",", "groupIDs", ",", "dataArray"}], "]"}]}], 
        ";"}], ",", "\[IndentingNewLine]", "coalitions", ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"subNormalization", "=", 
         RowBox[{
          RowBox[{"(", "ssSize", ")"}], "^", 
          RowBox[{"(", 
           RowBox[{"1", "/", "2"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        "\t", 
        RowBox[{"fullNormalization", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Length", "[", 
            RowBox[{"Union", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"groupIDs", ",", "1"}], "]"}], "]"}], "]"}], ")"}], "^", 
          RowBox[{"(", 
           RowBox[{"1", "/", "2"}], ")"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"numCoalitions", "[", "matchIdxMtx", "]"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"1", "/", "2"}], ")"}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"nextRandomSubsample", ":=", 
         RowBox[{"generateRandomSubsample", "[", 
          RowBox[{"ssSize", ",", "groupIDs", ",", "dataArray"}], "]"}]}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"TCHRONIS", " ", "for", " ", "precomputed"}], "*)"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"estimates", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", "numSubsamples", "}"}]}], "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{"List", " ", "of", " ", "standardized", " ", "subsample", " ", 
       RowBox[{"estimates", "."}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ssEstimates", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", "numSubsamples", "}"}]}], "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{"List", " ", "of", " ", "raw", " ", "subsample", " ", 
       RowBox[{"estimates", "."}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"ssDataArray", "=", 
         RowBox[{"Transpose", "@", "nextRandomSubsample"}]}], ";", 
        "\[IndentingNewLine]", 
        StyleBox[
         RowBox[{"ssEstimate", "=", 
          RowBox[{
           RowBox[{"maximize", "[", 
            RowBox[{"ssDataArray", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"ssDataArray", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "method", ",", 
             "permuteinvariant", ",", "False"}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}]}],
         Background->RGBColor[1, 1, 0]], 
        StyleBox[";",
         Background->RGBColor[1, 1, 0]], "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"ssEstimates", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", "ssEstimate"}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"estimates", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", 
         RowBox[{"subNormalization", " ", 
          RowBox[{"(", 
           RowBox[{"ssEstimate", "-", "pointEstimate"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"progress", ">", "0"}], "&&", 
           RowBox[{
            RowBox[{"Mod", "[", 
             RowBox[{"i", ",", "progress"}], "]"}], "\[Equal]", "0"}]}], ",", 
          RowBox[{"WriteString", "[", 
           RowBox[{
           "\"\<stdout\>\"", ",", "\"\<\\n\>\"", ",", 
            "\"\<Iterations completed:\>\"", ",", 
            RowBox[{"ToString", "[", "i", "]"}], ",", "\"\<\\n\>\""}], 
           "]"}]}], 
         RowBox[{"(*", "TCHRONIS", "*)"}], 
         RowBox[{"(*", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<Iterations completed: \>\"", "<>", 
            RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "*)"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"subsampleMonitor", "/.", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"options", ",", 
              RowBox[{"Options", "[", "pointIdentifiedCR", "]"}]}], "}"}], 
            "]"}]}]}], "]"}], ";"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "numSubsamples"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"i", "\[LessEqual]", 
        RowBox[{"Length", "[", "args", "]"}]}], ",", 
       RowBox[{"i", "=", 
        RowBox[{"i", "+", "1"}]}], ",", 
       RowBox[{"Histogram", "[", 
        RowBox[{"estimates", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "i"}], "]"}], "]"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"alpha", "=", 
      RowBox[{"1", "-", "confLevel"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "TCHRONIS", " ", "both", " ", "symmetric", " ", "and", " ", 
       "assymetric", " ", "to", " ", "appear", " ", "in", " ", "the", " ", 
       "results"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<Symmetric case\>\"", ",", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"For", " ", "the", " ", "symmetric", " ", "case"}], ",", 
             RowBox[{
              RowBox[{
              "we", " ", "want", " ", "to", " ", "add", " ", "and", " ", 
               "subtract", " ", "the", " ", "1"}], "-", 
              RowBox[{
               RowBox[{"alpha", "'"}], "th", " ", "quantile", " ", "from", 
               " ", "the", " ", "point", " ", 
               RowBox[{"estimate", ".", "We"}], " ", "take", " ", "the", " ", 
               "Abs", " ", "here", " ", "for", " ", 
               RowBox[{"simplicity", ":", 
                RowBox[{
                 RowBox[{"tn", "*", 
                  RowBox[{"Abs", "[", 
                   RowBox[{"x", "-", "y"}], "]"}]}], "\[Equal]", 
                 RowBox[{"Abs", "[", 
                  RowBox[{"tn", "*", 
                   RowBox[{"(", 
                    RowBox[{"x", "-", "y"}], ")"}]}], "]"}]}]}]}]}]}], "*)"}],
            "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"cr", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"pointEstimate", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "-", 
                RowBox[{
                 RowBox[{"Reverse", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "1"}], "}"}], "*", 
                   RowBox[{"Quantile", "[", 
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{"estimates", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "i"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"1", "-", "alpha"}], ",", 
                    RowBox[{"1", "-", "alpha"}]}], "}"}]}], "]"}]}], "]"}], 
                 "/", "fullNormalization"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "args", "]"}]}], "}"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Thread", "[", 
             RowBox[{
              RowBox[{"header", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"4", "+", "1"}], ";;", 
                 RowBox[{"-", "2"}]}], "]"}], "]"}], "\[Rule]", "cr"}], 
             "]"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"\"\<Asymmetric case\>\"", ",", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
              RowBox[{
              "For", " ", "the", " ", "asymmetric", " ", "case", " ", "we", 
               " ", "separately", " ", "take", " ", "the", " ", 
               RowBox[{"alpha", "/", "2"}], " ", "and", " ", "1"}], "-", 
              RowBox[{
               RowBox[{"alpha", "/", "2"}], " ", "quantiles", " ", "and", " ",
                "subtract", " ", 
               RowBox[{"them", ".", "Keep"}], " ", "in", " ", "mind", " ", 
               "that", " ", "since", " ", "estimates", " ", "has", " ", "its",
                " ", "mean", " ", "subtracted"}]}], ",", 
             RowBox[{
             "only", " ", "in", " ", "freakishly", " ", "unlikely", " ", 
              "cases", " ", "will", " ", "these", " ", "two", " ", "have", 
              " ", "the", " ", "same", " ", 
              RowBox[{"sign", ".", "This"}], " ", "is", " ", "not", " ", 
              "true", " ", "for", " ", "the", " ", "symmetric", " ", 
              RowBox[{"case", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"cr", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"pointEstimate", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "-", 
                RowBox[{
                 RowBox[{"Reverse", "[", 
                  RowBox[{"Quantile", "[", 
                   RowBox[{
                    RowBox[{"estimates", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "i"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"alpha", "/", "2"}], ",", 
                    RowBox[{"1", "-", 
                    RowBox[{"alpha", "/", "2"}]}]}], "}"}]}], "]"}], "]"}], 
                 "/", "fullNormalization"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "args", "]"}]}], "}"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Thread", "[", 
             RowBox[{
              RowBox[{"header", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"4", "+", "1"}], ";;", 
                 RowBox[{"-", "2"}]}], "]"}], "]"}], "\[Rule]", "cr"}], 
             "]"}]}]}], "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]",
         "}"}], ",", "estimates"}], "}"}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"sym", "\[Equal]", "True"}], ",", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"For", " ", "the", " ", "symmetric", " ", "case"}], ",", 
         RowBox[{
          RowBox[{
          "we", " ", "want", " ", "to", " ", "add", " ", "and", " ", 
           "subtract", " ", "the", " ", "1"}], "-", 
          RowBox[{
           RowBox[{"alpha", "'"}], "th", " ", "quantile", " ", "from", " ", 
           "the", " ", "point", " ", 
           RowBox[{"estimate", ".", "We"}], " ", "take", " ", "the", " ", 
           "Abs", " ", "here", " ", "for", " ", 
           RowBox[{"simplicity", ":", 
            RowBox[{
             RowBox[{"tn", "*", 
              RowBox[{"Abs", "[", 
               RowBox[{"x", "-", "y"}], "]"}]}], "\[Equal]", 
             RowBox[{"Abs", "[", 
              RowBox[{"tn", "*", 
               RowBox[{"(", 
                RowBox[{"x", "-", "y"}], ")"}]}], "]"}]}]}]}]}]}], "*)"}], 
       RowBox[{"cr", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"pointEstimate", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "-", 
           RowBox[{
            RowBox[{"Reverse", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "1"}], "}"}], "*", 
              RowBox[{"Quantile", "[", 
               RowBox[{
                RowBox[{"Abs", "[", 
                 RowBox[{"estimates", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "i"}], "]"}], "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"1", "-", "alpha"}], ",", 
                  RowBox[{"1", "-", "alpha"}]}], "}"}]}], "]"}]}], "]"}], "/",
             "fullNormalization"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "args", "]"}]}], "}"}]}], "]"}]}], ",", 
       RowBox[{"(*", "Else", "*)"}], 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
          "For", " ", "the", " ", "asymmetric", " ", "case", " ", "we", " ", 
           "separately", " ", "take", " ", "the", " ", 
           RowBox[{"alpha", "/", "2"}], " ", "and", " ", "1"}], "-", 
          RowBox[{
           RowBox[{"alpha", "/", "2"}], " ", "quantiles", " ", "and", " ", 
           "subtract", " ", 
           RowBox[{"them", ".", "Keep"}], " ", "in", " ", "mind", " ", "that",
            " ", "since", " ", "estimates", " ", "has", " ", "its", " ", 
           "mean", " ", "subtracted"}]}], ",", 
         RowBox[{
         "only", " ", "in", " ", "freakishly", " ", "unlikely", " ", "cases", 
          " ", "will", " ", "these", " ", "two", " ", "have", " ", "the", " ",
           "same", " ", 
          RowBox[{"sign", ".", "This"}], " ", "is", " ", "not", " ", "true", 
          " ", "for", " ", "the", " ", "symmetric", " ", 
          RowBox[{"case", "."}]}]}], "*)"}], 
       RowBox[{"cr", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"pointEstimate", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "-", 
           RowBox[{
            RowBox[{"Reverse", "[", 
             RowBox[{"Quantile", "[", 
              RowBox[{
               RowBox[{"estimates", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "i"}], "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"alpha", "/", "2"}], ",", 
                 RowBox[{"1", "-", 
                  RowBox[{"alpha", "/", "2"}]}]}], "}"}]}], "]"}], "]"}], "/",
             "fullNormalization"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "args", "]"}]}], "}"}]}], "]"}]}]}], "]"}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"cr", ",", "estimates"}], "}"}]}], "\[IndentingNewLine]", 
    "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621762034285989*^9, 3.621762034285989*^9}, {
   3.621762074879739*^9, 3.621762112035989*^9}, {3.621762244910989*^9, 
   3.621762284348489*^9}, {3.621762318602395*^9, 3.621762553852395*^9}, {
   3.621765245921731*^9, 3.621765311093606*^9}, {3.6217654220662622`*^9, 
   3.6217654548631372`*^9}, 3.6217658407313013`*^9, {3.621766215716653*^9, 
   3.621766215997903*^9}, {3.621769429716653*^9, 3.621769446091653*^9}, {
   3.621769508732278*^9, 3.621769520201028*^9}, {3.621769708779153*^9, 
   3.621769720232278*^9}, {3.621769754013528*^9, 3.621769762529153*^9}, {
   3.6218221501167836`*^9, 3.621822152207634*^9}, {3.62182219039398*^9, 
   3.6218222077162457`*^9}, {3.621822294247239*^9, 3.621822295104661*^9}, {
   3.6218223576667233`*^9, 3.62182237033771*^9}, {3.6218239633897085`*^9, 
   3.6218239786556973`*^9}, 3.6218240194945645`*^9, {3.6218284958979273`*^9, 
   3.621828498542459*^9}, {3.621832519825143*^9, 3.621832563870088*^9}, 
   3.621833473802358*^9, 3.621834741695051*^9, {3.6218363852738266`*^9, 
   3.6218364093060536`*^9}, {3.6219127155578423`*^9, 
   3.6219127652609673`*^9}, {3.621925131925309*^9, 3.6219251443313403`*^9}, {
   3.6219251902049646`*^9, 3.6219253005519342`*^9}, {3.621925337776122*^9, 
   3.6219253643638678`*^9}, {3.630309945979539*^9, 3.630309955854539*^9}, {
   3.630310656606492*^9, 3.630310663340867*^9}, {3.630310758450242*^9, 
   3.630310801137742*^9}, {3.630310926387742*^9, 3.630310928872117*^9}, {
   3.630311377731492*^9, 3.630311401981492*^9}, {3.630311471465867*^9, 
   3.630311510340867*^9}, {3.630311600465867*^9, 3.630311600606492*^9}, 
   3.630312038262742*^9, {3.6305735182388506`*^9, 3.6305735196607256`*^9}, 
   3.6305735797701006`*^9, {3.6327449780180225`*^9, 3.6327450641462145`*^9}, {
   3.6528791216680803`*^9, 3.652879190210595*^9}, {3.6528793627139177`*^9, 
   3.652879390992766*^9}, {3.652879531407085*^9, 3.652879531911983*^9}, {
   3.652879681984426*^9, 3.6528798513998213`*^9}, {3.6528805149035273`*^9, 
   3.6528805356228247`*^9}, {3.653130410706168*^9, 3.653130414904791*^9}, {
   3.653130514901956*^9, 3.6531305281728897`*^9}, {3.653133780442318*^9, 
   3.653133784829921*^9}, {3.65313383473069*^9, 3.653133840717516*^9}, {
   3.67117043501856*^9, 3.6711705191520557`*^9}, 3.671170589183537*^9, {
   3.671170676304144*^9, 3.671170678191689*^9}, {3.671170727477832*^9, 
   3.671170733787592*^9}, {3.6711725380449657`*^9, 3.671172538701803*^9}},
 Background->RGBColor[0.88, 1, 0.88]]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1366, 702},
WindowMargins->{{1, Automatic}, {0, Automatic}},
Visible->True,
ShowSelection->True,
FrontEndVersion->"11.0 for Linux x86 (64-bit) (September 21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{
 "Info3621774458-2672526"->{
  Cell[4667, 145, 3520, 54, 144, "Print",
   CellTags->"Info3621774458-2672526"]}
 }
*)
(*CellTagsIndex
CellTagsIndex->{
 {"Info3621774458-2672526", 34721, 812}
 }
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 662, 9, 65, "Section"],
Cell[CellGroupData[{
Cell[1266, 35, 110, 1, 35, "Subsubsection"],
Cell[1379, 38, 272, 5, 33, "Text"],
Cell[1654, 45, 179, 4, 34, "Input"],
Cell[1836, 51, 148, 3, 34, "Input"],
Cell[1987, 56, 132, 2, 32, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[2168, 64, 162, 2, 65, "Section"],
Cell[CellGroupData[{
Cell[2355, 70, 314, 8, 50, "Input"],
Cell[2672, 80, 163, 3, 34, "Output"]
}, Open  ]],
Cell[2850, 86, 560, 12, 72, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[3435, 102, 279, 7, 34, "Input"],
Cell[3717, 111, 186, 4, 34, "Output"]
}, Open  ]],
Cell[3918, 118, 596, 19, 55, "Usage"],
Cell[CellGroupData[{
Cell[4539, 141, 125, 2, 32, "Input"],
Cell[4667, 145, 3520, 54, 144, "Print",
 CellTags->"Info3621774458-2672526"]
}, Open  ]],
Cell[8202, 202, 554, 12, 143, "Text"],
Cell[8759, 216, 3296, 79, 323, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[12080, 299, 109, 1, 35, "Subsubsection"],
Cell[12192, 302, 154, 2, 49, "Text"],
Cell[12349, 306, 21973, 489, 1919, "Input",
 InitializationCell->True]
}, Open  ]]
}, Open  ]]
}
]
*)

