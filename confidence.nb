(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     72156,       1700]
NotebookOptionsPosition[     70209,       1629]
NotebookOutlinePosition[     70773,       1653]
CellTagsIndexPosition[     70687,       1648]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["confidence.nb", "Section",
 CellChangeTimes->{{3.62600628385137*^9, 3.626006284835745*^9}, {
  3.6260709487170696`*^9, 3.6260709533480415`*^9}, {3.626096953477417*^9, 
  3.6260969551364455`*^9}, {3.6261707215015993`*^9, 3.6261707234205446`*^9}, {
  3.6261736078812375`*^9, 3.6261736107103395`*^9}, {3.6263372687397165`*^9, 
  3.6263372730053415`*^9}, {3.6263379196147165`*^9, 3.6263379214897165`*^9}, {
  3.6263385349740915`*^9, 3.6263385373022165`*^9}, {3.6263390808490915`*^9, 
  3.6263390821459665`*^9}, {3.6303029709067054`*^9, 3.6303029750165725`*^9}, {
  3.68546745525683*^9, 3.685467455411772*^9}, {3.6854675586727667`*^9, 
  3.685467560186207*^9}}],

Cell[CellGroupData[{

Cell["For the Developer", "Subsubsection",
 CellChangeTimes->{{3.5819225877880845`*^9, 3.581922592443351*^9}}],

Cell["\<\
AutoGeneratedPackage is an option for notebooks that specifies whether a \
package is automatically created when a notebook that contains initialization \
cells or groups is saved.\
\>", "Text",
 CellChangeTimes->{{3.5808982533077106`*^9, 3.580898259632072*^9}}],

Cell[BoxData[
 RowBox[{"SetOptions", "[", 
  RowBox[{
   RowBox[{"InputNotebook", "[", "]"}], ",", 
   RowBox[{"AutoGeneratedPackage", "\[Rule]", "Automatic"}]}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"$HistoryLength", "=", "0"}], ";"}]], "Input",
 CellChangeTimes->{{3.5816697178146343`*^9, 3.581669717815634*^9}}],

Cell[BoxData[
 RowBox[{"ClearSystemCache", "[", "]"}]], "Input",
 CellChangeTimes->{{3.581669726757145*^9, 3.5816697379287844`*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Confidence Intervals", "Section",
 CellChangeTimes->{{3.6216659659272532`*^9, 3.6216659761698494`*^9}, {
  3.6217614343934107`*^9, 3.6217614422059107`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"RandomSample", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6", ",", "7", ",", 
     "8"}], "}"}], ",", "4"}], "]"}]], "Input",
 CellChangeTimes->{{3.6327437593201857`*^9, 3.632743772456905*^9}},
 Background->RGBColor[1, 0.85, 0.85]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"4", ",", "5", ",", "3", ",", "6"}], "}"}]], "Output",
 CellChangeTimes->{{3.6327437728416705`*^9, 3.6327437838992877`*^9}}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Off", "[", 
   RowBox[{"General", "::", "compat"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<Combinatorica`\>\"", "]"}], 
  RowBox[{"(*", 
   RowBox[{"For", " ", "RandomKSubset"}], "*)"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6217635233846216`*^9, 3.6217635308377466`*^9}, {
  3.6217635920252466`*^9, 3.6217636063221216`*^9}, {3.621764203171731*^9, 
  3.621764226343606*^9}, {3.6303052201701193`*^9, 3.6303052402326193`*^9}},
 Background->RGBColor[0.88, 1, 0.88]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"RandomKSubset", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6", ",", "7", ",", 
     "8"}], "}"}], ",", "4"}], "]"}]], "Input",
 CellChangeTimes->{{3.6217636410252466`*^9, 3.6217636458533716`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"2", ",", "5", ",", "6", ",", "7"}], "}"}]], "Output",
 CellChangeTimes->{
  3.6217636463846216`*^9, {3.632743776016475*^9, 3.632743777893428*^9}}]
}, Open  ]],

Cell[BoxData[Cell[TextData[{
  Cell[BoxData[
   RowBox[{"RandomKSubset", "[", 
    RowBox[{
     StyleBox["l", "TI"], ",", 
     StyleBox["k", "TI"]}], "]"}]], "InlineFormula"],
  "\[LineSeparator]gives a random subset of set ",
  Cell[BoxData[
   FormBox[
    StyleBox["l", "TI"], TraditionalForm]], "InlineFormula"],
  " with exactly ",
  Cell[BoxData[
   FormBox[
    StyleBox["k", "TI"], TraditionalForm]], "InlineFormula"],
  " elements."
 }]]], "Usage",
 GridBoxOptions->{
 GridBoxBackground->{
  "Columns" -> {{None}}, "ColumnsIndexed" -> {}, "Rows" -> {{None}}, 
   "RowsIndexed" -> {}}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"?", "RandomChoice"}]], "Input",
 CellChangeTimes->{{3.6217636534471216`*^9, 3.6217636576346216`*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox["\<\"\\!\\(\\*RowBox[{\\\"RandomChoice\\\", \\\"[\\\", \
RowBox[{\\\"{\\\", RowBox[{SubscriptBox[StyleBox[\\\"e\\\", \\\"TI\\\"], \
StyleBox[\\\"1\\\", \\\"TR\\\"]], \\\",\\\", SubscriptBox[StyleBox[\\\"e\\\", \
\\\"TI\\\"], StyleBox[\\\"2\\\", \\\"TR\\\"]], \\\",\\\", StyleBox[\\\"\
\[Ellipsis]\\\", \\\"TR\\\"]}], \\\"}\\\"}], \\\"]\\\"}]\\) gives a \
pseudorandom choice of one of the \\!\\(\\*SubscriptBox[StyleBox[\\\"e\\\", \
\\\"TI\\\"], StyleBox[\\\"i\\\", \\\"TI\\\"]]\\). \
\\n\\!\\(\\*RowBox[{\\\"RandomChoice\\\", \\\"[\\\", \
RowBox[{StyleBox[\\\"list\\\", \\\"TI\\\"], \\\",\\\", StyleBox[\\\"n\\\", \\\
\"TI\\\"]}], \\\"]\\\"}]\\) gives a list of \\!\\(\\*StyleBox[\\\"n\\\", \
\\\"TI\\\"]\\) pseudorandom choices. \
\\n\\!\\(\\*RowBox[{\\\"RandomChoice\\\", \\\"[\\\", \
RowBox[{StyleBox[\\\"list\\\", \\\"TI\\\"], \\\",\\\", RowBox[{\\\"{\\\", \
RowBox[{SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], StyleBox[\\\"1\\\", \
\\\"TR\\\"]], \\\",\\\", SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], \
StyleBox[\\\"2\\\", \\\"TR\\\"]], \\\",\\\", StyleBox[\\\"\[Ellipsis]\\\", \\\
\"TR\\\"]}], \\\"}\\\"}]}], \\\"]\\\"}]\\) gives an \
\\!\\(\\*SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], StyleBox[\\\"1\\\", \\\
\"TR\\\"]]\\)\[Times]\\!\\(\\*SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], \
StyleBox[\\\"2\\\", \\\"TR\\\"]]\\)\[Times]\[Ellipsis] array of pseudorandom \
choices. \\n\\!\\(\\*RowBox[{\\\"RandomChoice\\\", \\\"[\\\", \
RowBox[{RowBox[{\\\"{\\\", RowBox[{SubscriptBox[StyleBox[\\\"w\\\", \
\\\"TI\\\"], StyleBox[\\\"1\\\", \\\"TR\\\"]], \\\",\\\", \
SubscriptBox[StyleBox[\\\"w\\\", \\\"TI\\\"], StyleBox[\\\"2\\\", \
\\\"TR\\\"]], \\\",\\\", StyleBox[\\\"\[Ellipsis]\\\", \\\"TR\\\"]}], \\\"}\\\
\"}], \\\"\[Rule]\\\", RowBox[{\\\"{\\\", RowBox[{SubscriptBox[StyleBox[\\\"e\
\\\", \\\"TI\\\"], StyleBox[\\\"1\\\", \\\"TR\\\"]], \\\",\\\", \
SubscriptBox[StyleBox[\\\"e\\\", \\\"TI\\\"], StyleBox[\\\"2\\\", \
\\\"TR\\\"]], \\\",\\\", StyleBox[\\\"\[Ellipsis]\\\", \\\"TR\\\"]}], \\\"}\\\
\"}]}], \\\"]\\\"}]\\) gives a pseudorandom choice weighted by the \
\\!\\(\\*SubscriptBox[StyleBox[\\\"w\\\", \\\"TI\\\"], StyleBox[\\\"i\\\", \\\
\"TI\\\"]]\\). \\n\\!\\(\\*RowBox[{\\\"RandomChoice\\\", \\\"[\\\", \
RowBox[{RowBox[{StyleBox[\\\"wlist\\\", \\\"TI\\\"], \\\"\[Rule]\\\", \
StyleBox[\\\"elist\\\", \\\"TI\\\"]}], \\\",\\\", StyleBox[\\\"n\\\", \
\\\"TI\\\"]}], \\\"]\\\"}]\\) gives a list of \\!\\(\\*StyleBox[\\\"n\\\", \\\
\"TI\\\"]\\) weighted choices.\\n\\!\\(\\*RowBox[{\\\"RandomChoice\\\", \\\"[\
\\\", RowBox[{RowBox[{StyleBox[\\\"wlist\\\", \\\"TI\\\"], \\\"\[Rule]\\\", \
StyleBox[\\\"elist\\\", \\\"TI\\\"]}], \\\",\\\", RowBox[{\\\"{\\\", \
RowBox[{SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], StyleBox[\\\"1\\\", \
\\\"TR\\\"]], \\\",\\\", SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], \
StyleBox[\\\"2\\\", \\\"TR\\\"]], \\\",\\\", StyleBox[\\\"\[Ellipsis]\\\", \\\
\"TR\\\"]}], \\\"}\\\"}]}], \\\"]\\\"}]\\) gives an \
\\!\\(\\*SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], StyleBox[\\\"1\\\", \\\
\"TR\\\"]]\\)\[Times]\\!\\(\\*SubscriptBox[StyleBox[\\\"n\\\", \\\"TI\\\"], \
StyleBox[\\\"2\\\", \\\"TR\\\"]]\\)\[Times]\[Ellipsis] array of weighted \
choices.\"\>", "MSG"], "\[NonBreakingSpace]", 
  ButtonBox[
   StyleBox["\[RightSkeleton]", "SR"],
   Active->True,
   BaseStyle->"Link",
   ButtonData->"paclet:ref/RandomChoice"]}]], "Print", "PrintUsage",
 CellChangeTimes->{3.6217636581658716`*^9},
 CellTags->"Info3621774458-2672526"]
}, Open  ]],

Cell["\<\
generateRandomSubsample - Generates a subsample of a given size from a data \
array.

Parameters:
ssSize - Size of the subsample generated,in terms of number of distinct \
entities that will be represented in the subsample (ie,nests or coalitions).
groupIDs - A data map that the routine will use to examine the rows of the \
data array for possible inclusion into the subsample.
dataArray - A data array structure suitable for passing into the objective \
function.\
\>", "Text",
 CellChangeTimes->{{3.62176264355552*^9, 3.62176268077427*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "generateRandomSubsample", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"generateRandomSubsample", "::", "usage"}], "=", 
   "\"\<generateRandomSubsample[ssSize,groupIDs,dataArray] generates a \
subsample of a given size from a data array.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"generateRandomSubsample", "[", 
    RowBox[{"ssSize_", ",", "groupIDs_", ",", "dataArray_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"totalGroups", ",", "groups", ",", "qualifiedIndexes"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"totalGroups", "=", 
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"groupIDs", ",", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"groups", "=", 
       RowBox[{"RandomKSubset", "[", 
        RowBox[{"totalGroups", ",", "ssSize"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"\"\<stdout\>\"", ",", "\"\< \>\"", ",", "groups"}], "]"}], 
      ";", 
      RowBox[{"(*", 
       RowBox[{"TCHRONIS", " ", "for", " ", "verbose", " ", "results"}], 
       "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Get", " ", "the", " ", "indexes", " ", "of", " ", "the", " ", 
        "dataArray", " ", "rows", " ", "that", " ", "correspond", " ", "to", 
        " ", "selected", " ", 
        RowBox[{"groups", "."}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"qualifiedIndexes", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"groupIDs", ",", 
         RowBox[{"_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Intersection", "[", 
              RowBox[{"groups", ",", "#"}], "]"}], "\[NotEqual]", 
             RowBox[{"{", "}"}]}], "&"}], ")"}]}], ",", 
         RowBox[{"{", "1", "}"}], ",", 
         RowBox[{"Heads", "\[Rule]", "False"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "We", " ", "want", " ", "to", " ", "extract", " ", "certain", " ", 
         "rows"}], ",", 
        RowBox[{
        "so", " ", "we", " ", "need", " ", "to", " ", "transpose", " ", 
         "before", " ", "and", " ", "after", " ", "extracting", " ", "the", 
         " ", "rows", " ", "we", " ", "want"}], ",", 
        RowBox[{"due", " ", "to", " ", "the", " ", "matrix", " ", 
         RowBox[{"layout", "."}]}]}], "*)"}], 
      RowBox[{"Transpose", "[", 
       RowBox[{"Extract", "[", 
        RowBox[{"(*", 
         RowBox[{"Transpose", "["}], "*)"}], 
        RowBox[{"dataArray", 
         RowBox[{"(*", "]", "*)"}], ",", "qualifiedIndexes"}], "]"}], 
       "]"}]}]}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"TCHRONIS", " ", "for", " ", "precomputed"}], "*)"}], "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621762624383645*^9, 3.62176263843052*^9}, {
  3.6217637177596216`*^9, 3.6217637417752466`*^9}, {3.6218520478289895`*^9, 
  3.621852052501769*^9}, {3.6327448994778166`*^9, 3.6327449463949757`*^9}},
 Background->RGBColor[0.88, 1, 0.88]],

Cell[CellGroupData[{

Cell["pontIdentifiedCR", "Subsubsection",
 CellChangeTimes->{{3.622095879428526*^9, 3.6220958913816504`*^9}}],

Cell["CHECK OUT THE GLOBAL VARIABLES", "Text",
 CellChangeTimes->{{3.6217637832752466`*^9, 3.6217637910096216`*^9}},
 Background->RGBColor[1, 0.85, 0.85]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "pointIdentifiedCR", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "pointIdentifiedCR", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"progressUpdate", "\[Rule]", "0"}], ",", 
     RowBox[{"confidenceLevel", "\[Rule]", ".95"}], ",", 
     RowBox[{"asymptotics", "\[Rule]", "nests"}], ",", 
     RowBox[{"subsampleMonitor", "\[Rule]", "Null"}], ",", 
     RowBox[{"symmetric", "\[Rule]", "False"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"pointIdentifiedCR", "::", "usage"}], "=", 
    "\"\<pointIdentifiedCR[ssSize,numSubsamples,pointEstimate,args,groupIDs,\
dataArray,method,permuteinvariant,options] generates a confidence region \
estimate using subsampling.\\r\nParameters:\nssSize - The size of each \
subsample to be estimated.\nnumSubsamples -The number of subsamples to use in \
estimating the confidence region.\npointEstimate - The point estimate to \
build the confidence region around (typically the output of pairwiseMSE).\n\
objFunc - The objective function used in pairwiseMSE.\nargs - A list of \
unique symbols used in pairwiseMSE.\ngroupIDs - A data map used to generate \
the subsamples.\ndataArray - The dataArray parameter used in pairwiseMSE.\n\
options - An optional parameter specifying options. Available options are:\n\t\
progressUpdate - How often to print progress (0 to disable).Default=0. \n\t\
confidenceLevel - The confidence level of the region.Default=.95.\n\t\
asymptotics - Type of asymptotics to use (nests or coalitions).Default=nests.\
\n\tsubsampleMonitor - An expression to evaluate for each \
subsample.Default=Null.\n\tsymmetric - True or False.If True,the confidence \
region will be symmetric.Default=False.\>\""}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pointIdentifiedCR", "[", 
   RowBox[{
   "ssSize_", ",", "numSubsamples_", ",", "pointEstimate_", ",", "args_", ",",
     "groupIDs_", ",", "dataArray_", ",", "method_", ",", "permuteinvariant_",
     ",", 
    RowBox[{"options___", "?", "OptionQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "progress", ",", "confLevel", ",", "asymp", ",", "ssDataArray", ",", 
      "estimates", ",", "estimate", ",", "alpha", ",", "cr", ",", "sym"}], 
     "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"progress", ",", "confLevel", ",", "asymp", ",", "sym"}], 
       "}"}], "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "progressUpdate", ",", "confidenceLevel", ",", "asymptotics", ",", 
         "symmetric"}], "}"}], "/.", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{"options", ",", 
          RowBox[{"Options", "[", "pointIdentifiedCR", "]"}]}], "}"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "This", " ", "block", " ", "sets", " ", "variables", " ", "that", " ", 
        "are", " ", "slightly", " ", "different", " ", "for", " ", "each", 
        " ", "of", " ", "the", " ", "two", " ", 
        RowBox[{"asymptotics", ".", "subNormalization"}], " ", "is", " ", 
        "the", " ", "standardization", " ", "multiplier", " ", "for", " ", 
        "the", " ", "subsamples"}], ",", 
       RowBox[{
       "fullNormalization", " ", "is", " ", "the", " ", "multiplier", " ", 
        "for", " ", "the", " ", "construction", " ", "of", " ", "the", " ", 
        "final", " ", "confidence", " ", "interval", " ", "from", " ", "all", 
        " ", "of", " ", "the", " ", 
        RowBox[{"subsamples", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{
      "asymp", ",", "\[IndentingNewLine]", "nests", ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"subNormalization", "=", 
         RowBox[{
          RowBox[{"(", "ssSize", ")"}], "^", 
          RowBox[{"(", 
           RowBox[{"1", "/", "3"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        "\t", 
        RowBox[{"fullNormalization", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Length", "[", 
            RowBox[{"Union", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"groupIDs", ",", "1"}], "]"}], "]"}], "]"}], ")"}], "^", 
          RowBox[{"(", 
           RowBox[{"1", "/", "3"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        "\t", 
        RowBox[{"nextRandomSubsample", ":=", 
         RowBox[{"generateRandomSubsample", "[", 
          RowBox[{"ssSize", ",", "groupIDs", ",", "dataArray"}], "]"}]}], 
        ";"}], ",", "\[IndentingNewLine]", "coalitions", ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"subNormalization", "=", 
         RowBox[{
          RowBox[{"(", "ssSize", ")"}], "^", 
          RowBox[{"(", 
           RowBox[{"1", "/", "2"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        "\t", 
        RowBox[{"fullNormalization", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Length", "[", 
            RowBox[{"Union", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"groupIDs", ",", "1"}], "]"}], "]"}], "]"}], ")"}], "^", 
          RowBox[{"(", 
           RowBox[{"1", "/", "2"}], ")"}]}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"numCoalitions", "[", "matchIdxMtx", "]"}], ")"}], "^", 
           RowBox[{"(", 
            RowBox[{"1", "/", "2"}], ")"}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"nextRandomSubsample", ":=", 
         RowBox[{"generateRandomSubsample", "[", 
          RowBox[{"ssSize", ",", "groupIDs", ",", "dataArray"}], "]"}]}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"TCHRONIS", " ", "for", " ", "precomputed"}], "*)"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"estimates", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", "numSubsamples", "}"}]}], "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{"List", " ", "of", " ", "standardized", " ", "subsample", " ", 
       RowBox[{"estimates", "."}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ssEstimates", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", "numSubsamples", "}"}]}], "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{"List", " ", "of", " ", "raw", " ", "subsample", " ", 
       RowBox[{"estimates", "."}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"ssDataArray", "=", 
         RowBox[{"Transpose", "@", "nextRandomSubsample"}]}], ";", 
        "\[IndentingNewLine]", 
        StyleBox[
         RowBox[{"ssEstimate", "=", 
          RowBox[{
           RowBox[{"maximize", "[", 
            RowBox[{"ssDataArray", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"ssDataArray", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "method", ",", 
             "permuteinvariant", ",", "False"}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}]}],
         Background->RGBColor[1, 1, 0]], 
        StyleBox[";",
         Background->RGBColor[1, 1, 0]], "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"ssEstimates", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", "ssEstimate"}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{
         RowBox[{"estimates", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", 
         RowBox[{"subNormalization", " ", 
          RowBox[{"(", 
           RowBox[{"ssEstimate", "-", "pointEstimate"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"progress", ">", "0"}], "&&", 
           RowBox[{
            RowBox[{"Mod", "[", 
             RowBox[{"i", ",", "progress"}], "]"}], "\[Equal]", "0"}]}], ",", 
          RowBox[{"WriteString", "[", 
           RowBox[{
           "\"\<stdout\>\"", ",", "\"\<\\n\>\"", ",", 
            "\"\<Iterations completed:\>\"", ",", 
            RowBox[{"ToString", "[", "i", "]"}], ",", "\"\<\\n\>\""}], 
           "]"}]}], 
         RowBox[{"(*", "TCHRONIS", "*)"}], 
         RowBox[{"(*", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<Iterations completed: \>\"", "<>", 
            RowBox[{"ToString", "[", "i", "]"}]}], "]"}], "*)"}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"subsampleMonitor", "/.", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{"options", ",", 
              RowBox[{"Options", "[", "pointIdentifiedCR", "]"}]}], "}"}], 
            "]"}]}]}], "]"}], ";"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "numSubsamples"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", 
       RowBox[{"i", "\[LessEqual]", 
        RowBox[{"Length", "[", "args", "]"}]}], ",", 
       RowBox[{"i", "=", 
        RowBox[{"i", "+", "1"}]}], ",", 
       RowBox[{"Histogram", "[", 
        RowBox[{"estimates", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "i"}], "]"}], "]"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"alpha", "=", 
      RowBox[{"1", "-", "confLevel"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "TCHRONIS", " ", "both", " ", "symmetric", " ", "and", " ", 
       "assymetric", " ", "to", " ", "appear", " ", "in", " ", "the", " ", 
       "results"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<Symmetric case\>\"", ",", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"For", " ", "the", " ", "symmetric", " ", "case"}], ",", 
             RowBox[{
              RowBox[{
              "we", " ", "want", " ", "to", " ", "add", " ", "and", " ", 
               "subtract", " ", "the", " ", "1"}], "-", 
              RowBox[{
               RowBox[{"alpha", "'"}], "th", " ", "quantile", " ", "from", 
               " ", "the", " ", "point", " ", 
               RowBox[{"estimate", ".", "We"}], " ", "take", " ", "the", " ", 
               "Abs", " ", "here", " ", "for", " ", 
               RowBox[{"simplicity", ":", 
                RowBox[{
                 RowBox[{"tn", "*", 
                  RowBox[{"Abs", "[", 
                   RowBox[{"x", "-", "y"}], "]"}]}], "\[Equal]", 
                 RowBox[{"Abs", "[", 
                  RowBox[{"tn", "*", 
                   RowBox[{"(", 
                    RowBox[{"x", "-", "y"}], ")"}]}], "]"}]}]}]}]}]}], "*)"}],
            "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"cr", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"pointEstimate", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "-", 
                RowBox[{
                 RowBox[{"Reverse", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "1"}], "}"}], "*", 
                   RowBox[{"Quantile", "[", 
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{"estimates", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "i"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"1", "-", "alpha"}], ",", 
                    RowBox[{"1", "-", "alpha"}]}], "}"}]}], "]"}]}], "]"}], 
                 "/", "fullNormalization"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "args", "]"}]}], "}"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Thread", "[", 
             RowBox[{
              RowBox[{"header", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"4", "+", "1"}], ";;", 
                 RowBox[{"-", "2"}]}], "]"}], "]"}], "\[Rule]", "cr"}], 
             "]"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"\"\<Asymmetric case\>\"", ",", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
              RowBox[{
              "For", " ", "the", " ", "asymmetric", " ", "case", " ", "we", 
               " ", "separately", " ", "take", " ", "the", " ", 
               RowBox[{"alpha", "/", "2"}], " ", "and", " ", "1"}], "-", 
              RowBox[{
               RowBox[{"alpha", "/", "2"}], " ", "quantiles", " ", "and", " ",
                "subtract", " ", 
               RowBox[{"them", ".", "Keep"}], " ", "in", " ", "mind", " ", 
               "that", " ", "since", " ", "estimates", " ", "has", " ", "its",
                " ", "mean", " ", "subtracted"}]}], ",", 
             RowBox[{
             "only", " ", "in", " ", "freakishly", " ", "unlikely", " ", 
              "cases", " ", "will", " ", "these", " ", "two", " ", "have", 
              " ", "the", " ", "same", " ", 
              RowBox[{"sign", ".", "This"}], " ", "is", " ", "not", " ", 
              "true", " ", "for", " ", "the", " ", "symmetric", " ", 
              RowBox[{"case", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"cr", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"pointEstimate", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "-", 
                RowBox[{
                 RowBox[{"Reverse", "[", 
                  RowBox[{"Quantile", "[", 
                   RowBox[{
                    RowBox[{"estimates", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "i"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"alpha", "/", "2"}], ",", 
                    RowBox[{"1", "-", 
                    RowBox[{"alpha", "/", "2"}]}]}], "}"}]}], "]"}], "]"}], 
                 "/", "fullNormalization"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "args", "]"}]}], "}"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Thread", "[", 
             RowBox[{
              RowBox[{"header", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"4", "+", "1"}], ";;", 
                 RowBox[{"-", "2"}]}], "]"}], "]"}], "\[Rule]", "cr"}], 
             "]"}]}]}], "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]",
         "}"}], ",", "estimates"}], "}"}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"sym", "\[Equal]", "True"}], ",", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"For", " ", "the", " ", "symmetric", " ", "case"}], ",", 
         RowBox[{
          RowBox[{
          "we", " ", "want", " ", "to", " ", "add", " ", "and", " ", 
           "subtract", " ", "the", " ", "1"}], "-", 
          RowBox[{
           RowBox[{"alpha", "'"}], "th", " ", "quantile", " ", "from", " ", 
           "the", " ", "point", " ", 
           RowBox[{"estimate", ".", "We"}], " ", "take", " ", "the", " ", 
           "Abs", " ", "here", " ", "for", " ", 
           RowBox[{"simplicity", ":", 
            RowBox[{
             RowBox[{"tn", "*", 
              RowBox[{"Abs", "[", 
               RowBox[{"x", "-", "y"}], "]"}]}], "\[Equal]", 
             RowBox[{"Abs", "[", 
              RowBox[{"tn", "*", 
               RowBox[{"(", 
                RowBox[{"x", "-", "y"}], ")"}]}], "]"}]}]}]}]}]}], "*)"}], 
       RowBox[{"cr", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"pointEstimate", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "-", 
           RowBox[{
            RowBox[{"Reverse", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "1"}], "}"}], "*", 
              RowBox[{"Quantile", "[", 
               RowBox[{
                RowBox[{"Abs", "[", 
                 RowBox[{"estimates", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "i"}], "]"}], "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"1", "-", "alpha"}], ",", 
                  RowBox[{"1", "-", "alpha"}]}], "}"}]}], "]"}]}], "]"}], "/",
             "fullNormalization"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "args", "]"}]}], "}"}]}], "]"}]}], ",", 
       RowBox[{"(*", "Else", "*)"}], 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
          "For", " ", "the", " ", "asymmetric", " ", "case", " ", "we", " ", 
           "separately", " ", "take", " ", "the", " ", 
           RowBox[{"alpha", "/", "2"}], " ", "and", " ", "1"}], "-", 
          RowBox[{
           RowBox[{"alpha", "/", "2"}], " ", "quantiles", " ", "and", " ", 
           "subtract", " ", 
           RowBox[{"them", ".", "Keep"}], " ", "in", " ", "mind", " ", "that",
            " ", "since", " ", "estimates", " ", "has", " ", "its", " ", 
           "mean", " ", "subtracted"}]}], ",", 
         RowBox[{
         "only", " ", "in", " ", "freakishly", " ", "unlikely", " ", "cases", 
          " ", "will", " ", "these", " ", "two", " ", "have", " ", "the", " ",
           "same", " ", 
          RowBox[{"sign", ".", "This"}], " ", "is", " ", "not", " ", "true", 
          " ", "for", " ", "the", " ", "symmetric", " ", 
          RowBox[{"case", "."}]}]}], "*)"}], 
       RowBox[{"cr", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"pointEstimate", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "-", 
           RowBox[{
            RowBox[{"Reverse", "[", 
             RowBox[{"Quantile", "[", 
              RowBox[{
               RowBox[{"estimates", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "i"}], "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"alpha", "/", "2"}], ",", 
                 RowBox[{"1", "-", 
                  RowBox[{"alpha", "/", "2"}]}]}], "}"}]}], "]"}], "]"}], "/",
             "fullNormalization"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "args", "]"}]}], "}"}]}], "]"}]}]}], "]"}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"cr", ",", "estimates"}], "}"}]}], "\[IndentingNewLine]", 
    "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621762034285989*^9, 3.621762034285989*^9}, {
   3.621762074879739*^9, 3.621762112035989*^9}, {3.621762244910989*^9, 
   3.621762284348489*^9}, {3.621762318602395*^9, 3.621762553852395*^9}, {
   3.621765245921731*^9, 3.621765311093606*^9}, {3.6217654220662622`*^9, 
   3.6217654548631372`*^9}, 3.6217658407313013`*^9, {3.621766215716653*^9, 
   3.621766215997903*^9}, {3.621769429716653*^9, 3.621769446091653*^9}, {
   3.621769508732278*^9, 3.621769520201028*^9}, {3.621769708779153*^9, 
   3.621769720232278*^9}, {3.621769754013528*^9, 3.621769762529153*^9}, {
   3.6218221501167836`*^9, 3.621822152207634*^9}, {3.62182219039398*^9, 
   3.6218222077162457`*^9}, {3.621822294247239*^9, 3.621822295104661*^9}, {
   3.6218223576667233`*^9, 3.62182237033771*^9}, {3.6218239633897085`*^9, 
   3.6218239786556973`*^9}, 3.6218240194945645`*^9, {3.6218284958979273`*^9, 
   3.621828498542459*^9}, {3.621832519825143*^9, 3.621832563870088*^9}, 
   3.621833473802358*^9, 3.621834741695051*^9, {3.6218363852738266`*^9, 
   3.6218364093060536`*^9}, {3.6219127155578423`*^9, 
   3.6219127652609673`*^9}, {3.621925131925309*^9, 3.6219251443313403`*^9}, {
   3.6219251902049646`*^9, 3.6219253005519342`*^9}, {3.621925337776122*^9, 
   3.6219253643638678`*^9}, {3.630309945979539*^9, 3.630309955854539*^9}, {
   3.630310656606492*^9, 3.630310663340867*^9}, {3.630310758450242*^9, 
   3.630310801137742*^9}, {3.630310926387742*^9, 3.630310928872117*^9}, {
   3.630311377731492*^9, 3.630311401981492*^9}, {3.630311471465867*^9, 
   3.630311510340867*^9}, {3.630311600465867*^9, 3.630311600606492*^9}, 
   3.630312038262742*^9, {3.6305735182388506`*^9, 3.6305735196607256`*^9}, 
   3.6305735797701006`*^9, {3.6327449780180225`*^9, 3.6327450641462145`*^9}, {
   3.6528791216680803`*^9, 3.652879190210595*^9}, {3.6528793627139177`*^9, 
   3.652879390992766*^9}, {3.652879531407085*^9, 3.652879531911983*^9}, {
   3.652879681984426*^9, 3.6528798513998213`*^9}, {3.6528805149035273`*^9, 
   3.6528805356228247`*^9}, {3.653130410706168*^9, 3.653130414904791*^9}, {
   3.653130514901956*^9, 3.6531305281728897`*^9}, {3.653133780442318*^9, 
   3.653133784829921*^9}, {3.65313383473069*^9, 3.653133840717516*^9}, {
   3.67117043501856*^9, 3.6711705191520557`*^9}, 3.671170589183537*^9, {
   3.671170676304144*^9, 3.671170678191689*^9}, {3.671170727477832*^9, 
   3.671170733787592*^9}, {3.6711725380449657`*^9, 3.671172538701803*^9}},
 Background->RGBColor[0.88, 1, 0.88]]
}, Open  ]],

Cell[CellGroupData[{

Cell["setIdentifiedCR", "Subsubsection",
 CellChangeTimes->{{3.622095905366026*^9, 3.622095914741026*^9}}],

Cell["\<\
setIdentifiedCR-Generates a confidence region estimate using the \
set-identified procedure in Shaikh (2006).The parameters are exactly the same \
as pointIdentifiedCR except that symmetric is not an option.\
\>", "Text",
 CellChangeTimes->{3.6220959760662208`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "setIdentifiedCR", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "setIdentifiedCR", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"progressUpdate", "\[Rule]", "0"}], ",", 
      RowBox[{"confidenceLevel", "\[Rule]", ".95"}], ",", 
      RowBox[{"asymptotics", "\[Rule]", "nests"}], ",", 
      RowBox[{"subsampleMonitor", "\[Rule]", "Null"}], ",", 
      RowBox[{"symmetric", "\[Rule]", "False"}]}], "}"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"setIdentifiedCR", "[", 
   RowBox[{
   "ssSize_", ",", "numSubsamples_", ",", "pointEstimate_", ",", "objFunc_", 
    ",", "args_", ",", "groupIDs_", ",", "dataArray_", ",", "method_", ",", 
    "permuteinvariant_", ",", 
    RowBox[{"options___", "?", "OptionQ"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "progress", ",", "confLevel", ",", "ineq", ",", "asymp", ",", 
      "totalGroups", ",", "subsamples", ",", "estimates", ",", "alpha", ",", 
      "dhat", ",", "sym"}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"progress", ",", "confLevel", ",", "asymp", ",", "sym"}], 
       "}"}], "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "progressUpdate", ",", "confidenceLevel", ",", "asymptotics", ",", 
         "symmetric"}], "}"}], "/.", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{"options", ",", 
          RowBox[{"Options", "[", "setIdentifiedCR", "]"}]}], "}"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"totalGroups", "=", 
      RowBox[{"Length", "[", 
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"groupIDs", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"qwp", "[", 
       RowBox[{"x__", "?", "NumericQ"}], "]"}], ":=", 
      RowBox[{"objFunc", "[", 
       RowBox[{"dataArray", ",", "x"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "This", " ", "block", " ", "sets", " ", "variables", " ", "that", " ", 
        "are", " ", "slightly", " ", "different", " ", "for", " ", "each", 
        " ", "of", " ", "the", " ", "two", " ", 
        RowBox[{"asymptotics", ".", "subNormalization"}], " ", "is", " ", 
        "the", " ", "standardization", " ", "multiplier", " ", "for", " ", 
        "the", " ", "subsamples"}], ",", 
       RowBox[{
       "fullNormalization", " ", "is", " ", "the", " ", "multiplier", " ", 
        "for", " ", "the", " ", "construction", " ", "of", " ", "the", " ", 
        "final", " ", "confidence", " ", "interval", " ", "from", " ", "all", 
        " ", "of", " ", "the", " ", 
        RowBox[{"subsamples", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{"asymp", ",", "nests", ",", 
       RowBox[{
        RowBox[{"subNormalization", "=", 
         RowBox[{"ssSize", "^", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "1"}], "/", "3"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"fullNormalization", "=", 
         RowBox[{"totalGroups", "^", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "1"}], "/", "3"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"subsamples", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"generateRandomSubsample", "[", 
            RowBox[{"ssSize", ",", "groupIDs", ",", "dataArray"}], "]"}], ",", 
           RowBox[{"{", "numSubsamples", "}"}]}], "]"}]}], ";"}], ",", 
       "coalitions", ",", 
       RowBox[{
        RowBox[{"subNormalization", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"fullNormalization", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"subsamples", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"generateRandomSubsample", "[", 
            RowBox[{"ssSize", ",", "groupIDs", ",", "dataArray"}], "]"}], ",", 
           RowBox[{"{", "numSubsamples", "}"}]}], "]"}]}], ";"}]}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"This", " ", 
       RowBox[{"generates", "[", "numSubsamples", "]"}], " ", "subsample", 
       " ", 
       RowBox[{"estimates", ".", "They"}], " ", "will", " ", "be", " ", 
       "reused", " ", "throughout", " ", "the", " ", "rest", " ", "of", " ", 
       "the", " ", 
       RowBox[{"procedure", "."}]}], "*)"}], 
     RowBox[{"estimates", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", "numSubsamples", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Print", "[", "i", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"estimates", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", 
         StyleBox[
          RowBox[{
           RowBox[{"maximize", "[", 
            RowBox[{
             RowBox[{"subsamples", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"Length", "[", 
              RowBox[{
               RowBox[{"subsamples", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], ",", "False", 
             ",", "method", ",", "permuteinvariant"}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}],
          Background->RGBColor[1, 1, 0]]}], 
        StyleBox[";",
         Background->RGBColor[1, 1, 0]], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"progress", ">", "0"}], "&&", 
           RowBox[{
            RowBox[{"Mod", "[", 
             RowBox[{"i", ",", "progress"}], "]"}], "\[Equal]", "0"}]}], ",", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<Iterations completed: \>\"", "<>", 
            RowBox[{"ToString", "[", "i", "]"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"estimates", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "numSubsamples"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
        RowBox[{
        "This", " ", "is", " ", "the", " ", "\"\<dhat\>\"", " ", "quantile", 
         " ", "function", " ", "from", " ", 
         RowBox[{"Shaikh", "'"}], "s", " ", 
         RowBox[{"paper", ".", "It"}], " ", "returns", " ", "the", " ", "1"}],
         "-", 
        RowBox[{
         RowBox[{"alpha", "'"}], "th", " ", "quantile", " ", "of", " ", "the",
          " ", "differences", " ", "of", " ", "the", " ", "objective", " ", 
         "function", " ", "between", " ", "x", " ", "and", " ", "the", " ", 
         "estimate", " ", "value"}]}], ",", 
       RowBox[{"standardized", "."}]}], "*)"}], 
     RowBox[{
      RowBox[{"dhat", "[", 
       RowBox[{"x__", "?", "NumericQ"}], "]"}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"objDiff", ",", "coverageStatistics"}], "}"}], ",", 
        RowBox[{
         RowBox[{"objDiff", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"objFunc", "[", 
                RowBox[{
                 RowBox[{"subsamples", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", "x"}], "]"}]}], "-", 
              " ", 
              RowBox[{"-", 
               RowBox[{"objFunc", "[", 
                RowBox[{
                 RowBox[{"subsamples", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"estimates", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}]}], "]"}]}]}], 
             ")"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "subsamples", "]"}]}], "}"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"coverageStatistics", "=", 
          RowBox[{"subNormalization", "*", "objDiff"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Quantile", "[", 
          RowBox[{"coverageStatistics", ",", 
           RowBox[{"1", "-", "alpha"}]}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"alpha", "=", 
      RowBox[{"1", "-", "confLevel"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"For", " ", "each", " ", "dimension", " ", 
        RowBox[{"(", 
         RowBox[{"length", "[", "args", "]"}], ")"}]}], ",", 
       RowBox[{
        RowBox[{"this", " ", "does", " ", "a", " ", "one"}], "-", 
        RowBox[{
        "dimensional", " ", "minimization", " ", "and", " ", "a", " ", 
         "maximization", " ", "from", " ", "a", " ", "point", " ", "known", 
         " ", "to", " ", "be", " ", "in", " ", "the", " ", "confidence", " ", 
         "region"}]}], ",", 
       RowBox[{
        RowBox[{
        "so", " ", "that", " ", "we", " ", "can", " ", "find", " ", "the", 
         " ", "dimension"}], "-", "by", "-", 
        RowBox[{"dimension", " ", "extents", " ", "of", " ", "the", " ", 
         RowBox[{"region", "."}]}]}]}], "*)"}], 
     RowBox[{"initialRegion", "=", 
      RowBox[{"MapIndexed", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"List", "[", 
          RowBox[{"#1", ",", 
           RowBox[{
            RowBox[{"pointEstimate", "[", 
             RowBox[{"[", 
              RowBox[{"First", "[", "#2", "]"}], "]"}], "]"}], "-", "2"}], 
           ",", 
           RowBox[{
            RowBox[{"pointEstimate", "[", 
             RowBox[{"[", 
              RowBox[{"First", "[", "#2", "]"}], "]"}], "]"}], "+", "2"}]}], 
          "]"}], "&"}], ",", "args"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<Initial Region = \>\"", ",", "initialRegion"}], "]"}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"cr", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<argsno=\>\"", ",", 
       RowBox[{"Length", "[", "args", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Print", "[", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"args", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"fullNormalization", "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"objFunc", "[", 
                RowBox[{
                "dataArray", ",", "x1", ",", "x2", ",", "x3", ",", "x4", ",", 
                 "x5"}], "]"}]}], "-", " ", 
              RowBox[{"-", 
               RowBox[{"qwp", "[", 
                RowBox[{"Sequence", "@@", "pointEstimate"}], "]"}]}]}], 
             ")"}]}], "\[LessEqual]", 
           RowBox[{"dhat", "[", 
            RowBox[{"Sequence", "@@", "args"}], "]"}]}]}], "}"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";"}], 
      "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<#\>\"", ",", "i"}], "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"clow", "=", 
         RowBox[{
          RowBox[{"args", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "/.", 
          RowBox[{
           RowBox[{"NMinimize", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"args", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{
                RowBox[{"fullNormalization", "*", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"objFunc", "[", 
                    RowBox[{"dataArray", ",", 
                    RowBox[{"Sequence", "@@", "args"}]}], "]"}]}], "-", " ", 
                   RowBox[{"-", 
                    RowBox[{"qwp", "[", 
                    RowBox[{"Sequence", "@@", "pointEstimate"}], "]"}]}]}], 
                  ")"}]}], "\[LessEqual]", 
                RowBox[{"dhat", "[", 
                 RowBox[{"Sequence", "@@", "args"}], "]"}]}]}], "}"}], ",", 
             "initialRegion", ",", 
             RowBox[{"StepMonitor", "\[RuleDelayed]", 
              RowBox[{"Print", "[", 
               RowBox[{"\"\<Minimize candidate value (clow): \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"args", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}]}], ",", 
             RowBox[{"Method", "\[Rule]", "\"\<DifferentialEvolution\>\""}], 
             ",", 
             RowBox[{"AccuracyGoal", "\[Rule]", "1"}], ",", 
             RowBox[{"PrecisionGoal", "\[Rule]", "1"}]}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"chigh", "=", 
         RowBox[{
          RowBox[{"args", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "/.", 
          RowBox[{
           RowBox[{"NMaximize", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"args", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{
                RowBox[{"fullNormalization", "*", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"objFunc", "[", 
                    RowBox[{"dataArray", ",", 
                    RowBox[{"Sequence", "@@", "args"}]}], "]"}]}], "-", " ", 
                   RowBox[{"-", 
                    RowBox[{"qwp", "[", 
                    RowBox[{"Sequence", "@@", "pointEstimate"}], "]"}]}]}], 
                  ")"}]}], "\[LessEqual]", 
                RowBox[{"dhat", "[", 
                 RowBox[{"Sequence", "@@", "args"}], "]"}]}]}], "}"}], ",", 
             "initialRegion", ",", 
             RowBox[{"StepMonitor", "\[RuleDelayed]", 
              RowBox[{"Print", "[", 
               RowBox[{"\"\<Maximize candidate value (chigh): \>\"", "<>", 
                RowBox[{"ToString", "[", 
                 RowBox[{"args", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}]}], ",", 
             RowBox[{"Method", "\[Rule]", "\"\<DifferentialEvolution\>\""}], 
             ",", 
             RowBox[{"AccuracyGoal", "\[Rule]", "1"}], ",", 
             RowBox[{"PrecisionGoal", "\[Rule]", "1"}]}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"cr", ",", 
          RowBox[{"{", 
           RowBox[{"clow", ",", "chigh"}], "}"}]}], "]"}], ";"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "[", "args", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"sym", ",", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "We", " ", "take", " ", "the", " ", "maximum", " ", "distance", " ", 
          "from", " ", "the", " ", "point", " ", "estimate", " ", "to", " ", 
          "either", " ", "end"}], ",", 
         RowBox[{
         "and", " ", "then", " ", "make", " ", "the", " ", "CR", " ", "have", 
          " ", "that", " ", "distance", " ", "from", " ", "the", " ", "point",
           " ", 
          RowBox[{"estimate", "."}]}]}], "*)"}], 
       RowBox[{
        RowBox[{"dist", "=", 
         RowBox[{"Abs", "[", 
          RowBox[{"cr", "-", "pointEstimate"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"deltas", "=", 
         RowBox[{"Map", "[", 
          RowBox[{"Max", ",", "dist"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pointEstimate", "+", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"Length", "[", "pointEstimate", "]"}], "}"}]}], "]"}], 
          "*", "deltas"}]}]}], ",", 
       RowBox[{"(*", "Else", "*)"}], "cr"}], "]"}]}]}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6220959463474708`*^9, 3.6220960902068458`*^9}, {
   3.6220963198005958`*^9, 3.6220963403318458`*^9}, {3.6222249957608414`*^9, 
   3.6222250321840935`*^9}, {3.622225119267748*^9, 3.622225126809683*^9}, {
   3.6222251594260736`*^9, 3.6222251641682034`*^9}, {3.6222251956405196`*^9, 
   3.6222251967173033`*^9}, {3.6222252417483788`*^9, 3.6222252953944473`*^9}, 
   3.622225357305435*^9, {3.622226403972455*^9, 3.622226407064252*^9}, {
   3.6222264387924023`*^9, 3.6222264453903704`*^9}, {3.6222267614826064`*^9, 
   3.6222267853846703`*^9}, 3.6222269603363457`*^9, {3.6222270702429175`*^9, 
   3.6222271050486856`*^9}, {3.6222271752665744`*^9, 
   3.6222271918745127`*^9}, {3.6222280816426306`*^9, 3.62222810212197*^9}, {
   3.62222950316299*^9, 3.622229512648001*^9}, {3.622229817371896*^9, 
   3.6222298226368074`*^9}, {3.6222300201753497`*^9, 
   3.6222300273042555`*^9}, {3.6222302210914044`*^9, 
   3.6222302354330206`*^9}, {3.6222311147322617`*^9, 
   3.6222311194032726`*^9}, {3.6222311604538355`*^9, 
   3.6222312047338214`*^9}, {3.622231627868894*^9, 3.62223164585893*^9}, {
   3.6222317215836587`*^9, 3.62223175178652*^9}, {3.6222317853877044`*^9, 
   3.622231789521226*^9}, {3.6222318727230844`*^9, 3.622231892710019*^9}, 
   3.6222319642446136`*^9, {3.622232022857505*^9, 3.622232056596336*^9}, {
   3.6222321791423426`*^9, 3.6222321928718348`*^9}, {3.6222323417973194`*^9, 
   3.622232371524227*^9}, 3.6222324337628*^9, {3.622232554895856*^9, 
   3.6222326620840683`*^9}, {3.6222327339586024`*^9, 3.622232773145358*^9}, {
   3.622232852004728*^9, 3.6222328587214465`*^9}, {3.622432731279681*^9, 
   3.622432737607806*^9}, {3.6224544460027046`*^9, 3.6224544960511417`*^9}, {
   3.622454548639884*^9, 3.6224545508685656`*^9}, {3.622454588339192*^9, 
   3.6224546000183578`*^9}, {3.6224546316321096`*^9, 
   3.6224546553352346`*^9}, {3.6224547706946096`*^9, 
   3.6224547722414846`*^9}, {3.6224548976321096`*^9, 
   3.6224549090071096`*^9}, {3.6224549407414846`*^9, 
   3.6224549496946096`*^9}, {3.6224549880227346`*^9, 
   3.6224549996008596`*^9}, {3.6224582340067325`*^9, 
   3.6224582461317325`*^9}, {3.6224582812879825`*^9, 3.6224583018598576`*^9}, 
   3.6224612031937466`*^9, {3.622462116133979*^9, 3.622462164075796*^9}, {
   3.622550819821995*^9, 3.62255082043137*^9}, 3.62255086274387*^9},
 Background->RGBColor[0.88, 1, 0.88]]
}, Open  ]],

Cell[CellGroupData[{

Cell["sampleSetIdentifiedCR", "Subsubsection",
 CellChangeTimes->{{3.6222332248638287`*^9, 3.622233235054192*^9}}],

Cell["\<\
sampleSetIdentifiedCR - Generates a random set of points that are inside a \
set-identified confidence region.

\tParameters:
\t\tssSize - The size of each subsample to be estimated.
\t\tnumSubsamples - The number of subsamples to use in estimating the \
confidence region.
\t\tnumSamplePoints - The number of points to randomly sample. Some subset of \
these points will 
\t\t\t\t          hopefully be found to be inside the confidence region,and \
thus returned in the output. 
\t\tpointEstimate - The point estimate to build the confidence region around \
(typically the output of pairwiseMSE).
\t\tobjFunc - The objective function used in pairwiseMSE.
\t\targs - A list of unique symbols used in pairwiseMSE.
\t\tgroupIDs - A data map used to generate the subsamples.
\t\tdataArray - The dataArray parameter used in pairwiseMSE.
\t\toptions - An optional parameter specifying options.Available options are:
\t\t\tprogressUpdate - How often to print progress (0 to disable).Default=0. 
\t\t\tconfidenceLevel - The confidence level of the region.Default=.95.
\t\t\tasymptotics - Type of asymptotics to use (nests or \
coalitions).Default=nests.
\t\t\tsubsampleMonitor - An expression to evaluate for each \
subsample.Default=Null.
\t\t\tsamplingVariance - The variance of the distribution used to draw the \
sample points.Default=20.*)\
\>", "Text",
 CellChangeTimes->{{3.622233254670706*^9, 3.6222332962505217`*^9}, {
  3.6222333754352427`*^9, 3.622233441950036*^9}, {3.6222335089712763`*^9, 
  3.622233579893368*^9}, {3.6222336619767523`*^9, 3.622233689229042*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "sampleSetIdentifiedCR", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "sampleSetIdentifiedCR", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"progressUpdate", "\[Rule]", "0"}], ",", 
      RowBox[{"confidenceLevel", "\[Rule]", ".95"}], ",", 
      RowBox[{"asymptotics", "\[Rule]", "nests"}], ",", 
      RowBox[{"subsampleMonitor", "\[Rule]", "Null"}], ",", 
      RowBox[{"samplingVariance", "\[Rule]", "20"}]}], "}"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sampleSetIdentifiedCR", "[", 
   RowBox[{
   "ssSize_", ",", "numSubsamples_", ",", "numSamplePoints_", ",", 
    "pointEstimate_", ",", "objFunc_", ",", "args_", ",", "groupIDs_", ",", 
    "dataArray_", ",", "method_", ",", "permuteinvariant_", ",", 
    RowBox[{"options___", "?", "OptionQ"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "progress", ",", "confLevel", ",", "ineq", ",", "asymp", ",", 
      "totalGroups", ",", "subsamples", ",", "estimates", ",", "alpha", ",", 
      "dhat", ",", "svar"}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"progress", ",", "confLevel", ",", "asymp", ",", "svar"}], 
       "}"}], "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "progressUpdate", ",", "confidenceLevel", ",", "asymptotics", ",", 
         "samplingVariance"}], "}"}], "/.", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{"options", ",", 
          RowBox[{"Options", "[", "sampleSetIdentifiedCR", "]"}]}], "}"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"totalGroups", "=", 
      RowBox[{"Length", "[", 
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"groupIDs", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"qwp", "[", 
       RowBox[{"x__", "?", "NumericQ"}], "]"}], ":=", 
      RowBox[{"objFunc", "[", 
       RowBox[{"dataArray", ",", "x"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "This", " ", "block", " ", "sets", " ", "variables", " ", "that", " ", 
        "are", " ", "slightly", " ", "different", " ", "for", " ", "each", 
        " ", "of", " ", "the", " ", "two", " ", 
        RowBox[{"asymptotics", ".", "subNormalization"}], " ", "is", " ", 
        "the", " ", "standardization", " ", "multiplier", " ", "for", " ", 
        "the", " ", "subsamples"}], ",", 
       RowBox[{
       "fullNormalization", " ", "is", " ", "the", " ", "multiplier", " ", 
        "for", " ", "the", " ", "construction", " ", "of", " ", "the", " ", 
        "final", " ", "confidence", " ", "interval", " ", "from", " ", "all", 
        " ", "of", " ", "the", " ", 
        RowBox[{"subsamples", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{
      "asymp", ",", "\[IndentingNewLine]", "nests", ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"subNormalization", "=", 
         RowBox[{"ssSize", "^", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "1"}], "/", "3"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"fullNormalization", "=", 
         RowBox[{"totalGroups", "^", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "1"}], "/", "3"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"subsamples", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"generateRandomSubsample", "[", 
            RowBox[{"ssSize", ",", "groupIDs", ",", "dataArray"}], "]"}], ",", 
           RowBox[{"{", "numSubsamples", "}"}]}], "]"}]}], ";"}], ",", 
       "\[IndentingNewLine]", "coalitions", ",", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"subNormalization", "=", "1"}], ";", "\[IndentingNewLine]", 
        "\t", 
        RowBox[{"fullNormalization", "=", "1"}], ";", "\[IndentingNewLine]", 
        "\t", 
        RowBox[{"subsamples", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"generateRandomSubsample", "[", 
            RowBox[{"ssSize", ",", "groupIDs", ",", "dataArray"}], "]"}], ",", 
           RowBox[{"{", "numSubsamples", "}"}]}], "]"}]}], ";"}]}], "]"}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"This", " ", 
       RowBox[{"generates", "[", "numSubsamples", "]"}], " ", "subsample", 
       " ", 
       RowBox[{"estimates", ".", "They"}], " ", "will", " ", "be", " ", 
       "reused", " ", "throughout", " ", "the", " ", "rest", " ", "of", " ", 
       "the", " ", 
       RowBox[{"procedure", "."}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"estimates", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", "numSubsamples", "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"estimates", "[", 
          RowBox[{"[", "i", "]"}], "]"}], "=", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"args", "/.", 
            RowBox[{
             RowBox[{"pairwiseMSE", "[", 
              RowBox[{"objFunc", ",", 
               RowBox[{"subsamples", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", "args", ",", "options"}],
               "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         StyleBox[
          RowBox[{
           RowBox[{"maximize", "[", 
            RowBox[{
             RowBox[{"subsamples", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"Length", "[", 
              RowBox[{
               RowBox[{"subsamples", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], ",", "False", 
             ",", "method", ",", "permuteinvariant"}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}],
          Background->RGBColor[1, 1, 0]]}], 
        StyleBox[";",
         Background->RGBColor[1, 1, 0]], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"progress", ">", "0"}], "&&", 
           RowBox[{
            RowBox[{"Mod", "[", 
             RowBox[{"i", ",", "progress"}], "]"}], "\[Equal]", "0"}]}], ",", 
          "\[IndentingNewLine]", "\t", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<Iterations completed: \>\"", "<>", 
            RowBox[{"ToString", "[", "i", "]"}]}], "]"}]}], "]"}], ";"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "numSubsamples"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
        RowBox[{
        "This", " ", "is", " ", "the", " ", "\"\<dhat\>\"", " ", "quantile", 
         " ", "function", " ", "from", " ", 
         RowBox[{"Shaikh", "'"}], "s", " ", 
         RowBox[{"paper", ".", "It"}], " ", "returns", " ", "the", " ", "1"}],
         "-", 
        RowBox[{
         RowBox[{"alpha", "'"}], "th", " ", "quantile", " ", "of", " ", "the",
          " ", "differences", " ", "of", " ", "the", " ", "objective", " ", 
         "function", " ", "between", " ", "x", " ", "and", " ", "the", " ", 
         "estimate", " ", "value"}]}], ",", 
       RowBox[{"standardized", "."}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dhat", "[", 
       RowBox[{"x__", "?", "NumericQ"}], "]"}], ":=", "\[IndentingNewLine]", 
      "\t", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"objDiff", ",", "coverageStatistics"}], "}"}], ",", 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{
         RowBox[{"objDiff", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"objFunc", "[", 
                RowBox[{
                 RowBox[{"subsamples", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", "x"}], "]"}]}], 
              "\[IndentingNewLine]", "\t\t\t\t   ", "-", " ", 
              RowBox[{"-", 
               RowBox[{"objFunc", "[", 
                RowBox[{
                 RowBox[{"subsamples", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"(", 
                   RowBox[{"estimates", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}]}]}], "]"}]}]}], 
             ")"}], ",", "\[IndentingNewLine]", "\t\t\t\t\t", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "subsamples", "]"}]}], "}"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", "\t\t", 
         RowBox[{"coverageStatistics", "=", 
          RowBox[{"subNormalization", "*", "objDiff"}]}], ";", 
         "\[IndentingNewLine]", "\t\t", 
         RowBox[{"Quantile", "[", 
          RowBox[{"coverageStatistics", ",", 
           RowBox[{"1", "-", "alpha"}]}], "]"}]}]}], "\[IndentingNewLine]", 
       "\t", "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
        RowBox[{
        "This", " ", "alternate", " ", "version", " ", "of", " ", "dhat", " ",
          "is", " ", "worth", " ", 
         RowBox[{"remembering", ".", 
          RowBox[{"dhat", "[", 
           RowBox[{"x__", "?", "NumericQ"}], "]"}]}]}], ":=", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", "coverageStatistics", "}"}], ",", 
          RowBox[{
           RowBox[{"coverageStatistics", "=", 
            RowBox[{"subNormalization", "*", 
             RowBox[{"MapIndexed", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"objFunc", "[", 
                    RowBox[{"#1", ",", "x"}], "]"}]}], "-", 
                  RowBox[{"-", 
                   RowBox[{"objFunc", "[", 
                    RowBox[{"#1", ",", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"(", 
                    RowBox[{"estimates", "[", 
                    RowBox[{"[", 
                    RowBox[{"First", "[", "#2", "]"}], "]"}], "]"}], 
                    ")"}]}]}], "]"}]}]}], ")"}], "&"}], ",", "subsamples"}], 
              "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Quantile", "[", 
            RowBox[{"coverageStatistics", ",", 
             RowBox[{"1", "-", "alpha"}]}], "]"}]}]}], "]"}]}], ";"}], "*)"}],
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"isInCR", "[", "point_", "]"}], ":=", 
      RowBox[{
       RowBox[{"fullNormalization", "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"qwp", "[", 
            RowBox[{"Sequence", "@@", "point"}], "]"}]}], "-", " ", 
          RowBox[{"-", 
           RowBox[{"qwp", "[", 
            RowBox[{"Sequence", "@@", "pointEstimate"}], "]"}]}]}], ")"}]}], 
       "\[LessEqual]", 
       RowBox[{"dhat", "[", 
        RowBox[{"Sequence", "@@", "point"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"alpha", "=", 
      RowBox[{"1", "-", "confLevel"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"cr", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pt", "=", 
         RowBox[{
          StyleBox["RandomVariate",
           Background->RGBColor[1, 1, 0]], "[", 
          RowBox[{"MultinormalDistribution", "[", 
           RowBox[{"pointEstimate", ",", 
            RowBox[{"svar", "*", 
             RowBox[{"IdentityMatrix", "[", 
              RowBox[{"Length", "[", "args", "]"}], "]"}]}]}], "]"}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"isInCR", "[", "pt", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"cr", ",", "pt"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
         "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "numSamplePoints"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "cr"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6222332380360246`*^9, 3.622233249632005*^9}, {
   3.622233702105019*^9, 3.622233718695247*^9}, {3.622233847311904*^9, 
   3.6222338477122946`*^9}, {3.622234145831924*^9, 3.6222341506786036`*^9}, {
   3.6222342824261255`*^9, 3.6222343043718166`*^9}, {3.6222343680441065`*^9, 
   3.6222344110509033`*^9}, {3.6222344649194603`*^9, 
   3.6222346873564024`*^9}, {3.6222348761077538`*^9, 3.6222348916565413`*^9}, 
   3.6222350190040913`*^9, {3.6224282555546646`*^9, 3.6224282714748735`*^9}, {
   3.622428354970393*^9, 3.6224283576762037`*^9}, {3.62242841140097*^9, 
   3.6224284269586725`*^9}, {3.6224284914448657`*^9, 
   3.6224285185967455`*^9}, {3.6224285666417103`*^9, 
   3.6224285737493773`*^9}, {3.622428613235139*^9, 3.6224286763937993`*^9}, {
   3.6224287226960807`*^9, 3.6224287252430615`*^9}, {3.6224287770013084`*^9, 
   3.6224287974321375`*^9}, {3.622428856834079*^9, 3.622428862231906*^9}, {
   3.622428899650467*^9, 3.622428903158658*^9}, {3.6224289699193563`*^9, 
   3.6224289726288013`*^9}, {3.6224291261011205`*^9, 
   3.6224291364171314`*^9}, {3.6224293813545637`*^9, 
   3.6224293862505074`*^9}, {3.622429456897848*^9, 3.622429463488864*^9}, {
   3.6224297652111435`*^9, 3.6224297686412287`*^9}, {3.6224302350808253`*^9, 
   3.622430241337075*^9}, {3.622430277824808*^9, 3.622430289348905*^9}, {
   3.6224304575813713`*^9, 3.6224304681751213`*^9}, {3.6224305271438713`*^9, 
   3.6224305274251213`*^9}, 3.6224313498931255`*^9, {3.6224316565157614`*^9, 
   3.6224316575626364`*^9}},
 Background->RGBColor[0.88, 1, 0.88]]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1366, 729},
WindowMargins->{{Automatic, -1}, {0, Automatic}},
Visible->True,
ShowSelection->True,
FrontEndVersion->"11.0 for Linux x86 (64-bit) (September 21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{
 "Info3621774458-2672526"->{
  Cell[4667, 145, 3520, 54, 144, "Print",
   CellTags->"Info3621774458-2672526"]}
 }
*)
(*CellTagsIndex
CellTagsIndex->{
 {"Info3621774458-2672526", 70581, 1642}
 }
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 662, 9, 65, "Section"],
Cell[CellGroupData[{
Cell[1266, 35, 110, 1, 35, "Subsubsection"],
Cell[1379, 38, 272, 5, 33, "Text"],
Cell[1654, 45, 179, 4, 67, "Input"],
Cell[1836, 51, 148, 3, 34, "Input"],
Cell[1987, 56, 132, 2, 32, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[2168, 64, 162, 2, 65, "Section"],
Cell[CellGroupData[{
Cell[2355, 70, 314, 8, 50, "Input"],
Cell[2672, 80, 163, 3, 34, "Output"]
}, Open  ]],
Cell[2850, 86, 560, 12, 72, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[3435, 102, 279, 7, 34, "Input"],
Cell[3717, 111, 186, 4, 34, "Output"]
}, Open  ]],
Cell[3918, 118, 596, 19, 55, "Usage"],
Cell[CellGroupData[{
Cell[4539, 141, 125, 2, 32, "Input"],
Cell[4667, 145, 3520, 54, 144, "Print",
 CellTags->"Info3621774458-2672526"]
}, Open  ]],
Cell[8202, 202, 554, 12, 143, "Text"],
Cell[8759, 216, 3296, 79, 323, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[12080, 299, 109, 1, 35, "Subsubsection"],
Cell[12192, 302, 154, 2, 49, "Text"],
Cell[12349, 306, 21973, 489, 1919, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[34359, 800, 106, 1, 35, "Subsubsection"],
Cell[34468, 803, 275, 5, 55, "Text"],
Cell[34746, 810, 19228, 441, 1567, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[54011, 1256, 114, 1, 118, "Subsubsection"],
Cell[54128, 1259, 1580, 30, 407, "Text"],
Cell[55711, 1291, 14470, 334, 1547, "Input",
 InitializationCell->True]
}, Open  ]]
}, Open  ]]
}
]
*)

